# Hugo æ„å»ºé—®é¢˜ä¿®å¤

**ä¿®å¤æ—¥æœŸ**: 2026-01-06 16:34:20
**ä¿®å¤äºº**: Claude + ZhienXuan
**é—®é¢˜çº§åˆ«**: ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¯¼è‡´æ„å»ºå¤±è´¥ï¼‰

---

## ğŸ“‹ é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
Error: error building site: render: failed to render pages
```

### æ ¹æœ¬åŸå› 
1. **Hugo ç‰ˆæœ¬è¿‡ä½**ï¼šCloudflare Pages é»˜è®¤ä½¿ç”¨ Hugo 0.58.2ï¼Œä½† PaperMod ä¸»é¢˜éœ€è¦ Hugo >= 0.146.0
2. **ç¼ºå°‘ Google Analytics partial**ï¼šPaperMod ä¸»é¢˜è°ƒç”¨äº†ä¸å­˜åœ¨çš„ `google_analytics.html` æ¨¡æ¿
3. **ä½¿ç”¨åºŸå¼ƒçš„ API**ï¼š`.Site.IsServer` åœ¨ Hugo 0.146.0 ä¸­å·²è¢«ç§»é™¤
4. **æ¨¡æ¿ä½œç”¨åŸŸé”™è¯¯**ï¼šåœ¨ `with` è¯­å¥ä¸­é”™è¯¯åœ°è®¿é—®ä¸Šä¸‹æ–‡å˜é‡

---

## ğŸ”§ ä¿®å¤è¿‡ç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šæŒ‡å®š Hugo ç‰ˆæœ¬

**æ–‡ä»¶**: `vercel.json`

**é—®é¢˜**ï¼š
```json
{
  "build": {
    "env": {
      "HUGO_VERSION": "0.140.0",  // âŒ ç‰ˆæœ¬å¤ªæ—§
      "HUGO_EXTENDED": "true"
    }
  }
}
```

**ä¿®å¤**ï¼š
```json
{
  "build": {
    "env": {
      "HUGO_VERSION": "0.146.0",  // âœ… å‡çº§åˆ° PaperMod æœ€ä½è¦æ±‚ç‰ˆæœ¬
      "HUGO_EXTENDED": "true"
    }
  }
}
```

**æäº¤**: `159327c` - fix: ä¿®å¤ Hugo ç‰ˆæœ¬å’Œç¼ºå¤±çš„ Google Analytics æ¨¡æ¿

---

### ç¬¬äºŒé˜¶æ®µï¼šåˆ›å»ºç¼ºå¤±çš„ Google Analytics æ¨¡æ¿

**é—®é¢˜**ï¼š
```
ERROR: partial "google_analytics.html" not found
```

**æ–‡ä»¶**: `layouts/partials/google_analytics.html`ï¼ˆæ–°å»ºï¼‰

**åˆå§‹ç‰ˆæœ¬**ï¼ˆæœ‰é”™è¯¯ï¼‰ï¼š
```go
{{- if not .Site.IsServer -}}  // âŒ åºŸå¼ƒçš„ API
  {{- with .Site.Config.Privacy.GoogleAnalytics -}}
    {{- if not .Disable -}}
      {{ if .Site.Config.Services.GoogleAnalytics.ID }}
      <script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Config.Services.GoogleAnalytics.ID }}"></script>
      ...
```

---

### ç¬¬ä¸‰é˜¶æ®µï¼šä¿®å¤åºŸå¼ƒçš„ API

**é—®é¢˜**ï¼š
```
ERROR: can't evaluate field IsServer in type page.Site
```

**åŸå› **ï¼šHugo 0.146.0 ç§»é™¤äº† `.Site.IsServer`

**ä¿®å¤**ï¼š
```go
{{- if hugo.IsProduction -}}  // âœ… ä½¿ç”¨æ–°çš„å…¨å±€å‡½æ•°
  {{- with .Site.Config.Privacy.GoogleAnalytics -}}
```

**æäº¤**: `0ab5c2e` - fix: ä¿®å¤ Google Analytics æ¨¡æ¿ä¸­çš„ IsServer å…¼å®¹æ€§é—®é¢˜

---

### ç¬¬å››é˜¶æ®µï¼šä¿®å¤æ¨¡æ¿ä½œç”¨åŸŸé—®é¢˜

**é—®é¢˜**ï¼š
```
ERROR: can't evaluate field Site in type privacy.GoogleAnalytics
```

**åŸå› **ï¼š`{{ with ... }}` æ”¹å˜äº†ä¸Šä¸‹æ–‡ï¼Œæ— æ³•è®¿é—® `.Site`

**é”™è¯¯ä»£ç **ï¼š
```go
{{- with .Site.Config.Privacy.GoogleAnalytics -}}
  {{ if .Site.Config.Services.GoogleAnalytics.ID }}  // âŒ .Site åœ¨ with å†…è®¿é—®ä¸åˆ°
```

**æ­£ç¡®ä»£ç **ï¼š
```go
{{- if not .Site.Config.Privacy.GoogleAnalytics.Disable -}}
  {{- with .Site.Config.Services.GoogleAnalytics.ID -}}
    gtag('config', '{{ . }}', {
      'anonymize_ip': {{ $.Site.Config.Privacy.GoogleAnalytics.RespectDoNotTrack }}  // âœ… ä½¿ç”¨ $ è®¿é—®æ ¹ä¸Šä¸‹æ–‡
    });
```

**æäº¤**: `614c89b` - fix: ä¿®å¤ Google Analytics æ¨¡æ¿ä¸­çš„ä½œç”¨åŸŸé—®é¢˜

---

## âœ… æœ€ç»ˆä¿®å¤ç»“æœ

### åˆ›å»ºçš„æ–‡ä»¶

1. **vercel.json** - Hugo ç‰ˆæœ¬é…ç½®
   ```json
   {
     "build": {
       "env": {
         "HUGO_VERSION": "0.146.0",
         "HUGO_EXTENDED": "true"
       }
     }
   }
   ```

2. **layouts/partials/google_analytics.html** - Google Analytics æ¨¡æ¿
   ```go
   {{- if hugo.IsProduction -}}
     {{- if not .Site.Config.Privacy.GoogleAnalytics.Disable -}}
       {{- with .Site.Config.Services.GoogleAnalytics.ID -}}
         <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
         <script>
           window.dataLayer = window.dataLayer || [];
           function gtag(){dataLayer.push(arguments);}
           gtag('js', new Date());
           gtag('config', '{{ . }}', { 'anonymize_ip': {{ $.Site.Config.Privacy.GoogleAnalytics.RespectDoNotTrack }} });
         </script>
       {{- end -}}
     {{- end -}}
   {{- end -}}
   ```

### ä¿®æ”¹çš„æ–‡ä»¶

1. **config.toml** - ä» Giscus åˆ‡æ¢åˆ° Twikoo è¯„è®ºç³»ç»Ÿ
2. **layouts/partials/comments.html** - åˆ›å»º Twikoo è¯„è®ºç»„ä»¶

---

## ğŸ“Š çŸ¥è¯†æ€»ç»“

### Hugo ç‰ˆæœ¬ API å˜åŒ–

| åºŸå¼ƒçš„ API | æ–° API | Hugo ç‰ˆæœ¬ |
|-----------|--------|----------|
| `.Site.IsServer` | `hugo.IsProduction` | >= 0.140.0 |

### æ¨¡æ¿ä½œç”¨åŸŸè§„åˆ™

```go
{{ with .SomeValue }}
  {{ . }}           // âœ… æŒ‡å‘ .SomeValue
  {{ $.Site }}      // âœ… ä½¿ç”¨ $ è®¿é—®æ ¹ä¸Šä¸‹æ–‡
  {{ .Site }}       // âŒ é”™è¯¯ï¼š.Site åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨
{{ end }}
```

### PaperMod ä¸»é¢˜è¦æ±‚

- **æœ€ä½ Hugo ç‰ˆæœ¬**: 0.146.0
- **æ¨èç‰ˆæœ¬**: æœ€æ–°ç¨³å®šç‰ˆ
- **å¿…éœ€çš„ partials**:
  - `google_analytics.html`
  - `comments.html`
  - `head.html`ï¼ˆä¸»é¢˜è‡ªå¸¦ï¼‰

---

## ğŸš€ CI/CD é…ç½®æ€»ç»“

### Vercel é…ç½®

```json
{
  "build": {
    "env": {
      "HUGO_VERSION": "0.146.0",
      "HUGO_EXTENDED": "true"
    }
  }
}
```

### Cloudflare Pages é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

åœ¨æ„å»ºè®¾ç½®ä¸­ï¼š
- **æ„å»ºå‘½ä»¤**: `hugo --gc --minify`
- **ç¯å¢ƒå˜é‡**:
  - `HUGO_VERSION`: `0.146.0`
  - `HUGO_EXTENDED`: `true`

### GitHub Actions é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

```yaml
- name: Setup Hugo
  uses: peaceiris/actions-hugo@v2
  with:
    hugo-version: '0.146.0'
    extended: true
```

---

## ğŸ“ ç›¸å…³æäº¤

- `0883ab3` - feat: é›†æˆ Twikoo è¯„è®ºç³»ç»Ÿå¹¶ä¿®å¤ Hugo æ„å»ºé—®é¢˜
- `159327c` - fix: ä¿®å¤ Hugo ç‰ˆæœ¬å’Œç¼ºå¤±çš„ Google Analytics æ¨¡æ¿
- `0ab5c2e` - fix: ä¿®å¤ Google Analytics æ¨¡æ¿ä¸­çš„ IsServer å…¼å®¹æ€§é—®é¢˜
- `614c89b` - fix: ä¿®å¤ Google Analytics æ¨¡æ¿ä¸­çš„ä½œç”¨åŸŸé—®é¢˜

---

## ğŸ¯ éªŒè¯æ¸…å•

- [x] Hugo ç‰ˆæœ¬æ­£ç¡®ï¼ˆ0.146.0ï¼‰
- [x] Google Analytics partial å­˜åœ¨
- [x] ä½¿ç”¨ `hugo.IsProduction` è€Œé `.Site.IsServer`
- [x] æ¨¡æ¿ä½œç”¨åŸŸæ­£ç¡®
- [x] æœ¬åœ°æ„å»ºæˆåŠŸ
- [x] Cloudflare Pages æ„å»ºæˆåŠŸ

---

## ğŸ’¡ ç»éªŒæ•™è®­

1. **Always check theme requirements**: ä½¿ç”¨ä¸»é¢˜å‰ï¼ŒåŠ¡å¿…æ£€æŸ¥å…¶ Hugo ç‰ˆæœ¬è¦æ±‚
2. **Watch for deprecated APIs**: Hugo æ›´æ–°é¢‘ç¹ï¼Œæ³¨æ„åºŸå¼ƒçš„ API
3. **Understand template context**: Hugo æ¨¡æ¿çš„ `with` è¯­å¥ä¼šæ”¹å˜ä¸Šä¸‹æ–‡
4. **Add version control files**: å¯¹äº CI/CDï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šå·¥å…·ç‰ˆæœ¬
5. **Test locally first**: æœ¬åœ°æµ‹è¯•åå†æ¨é€åˆ°è¿œç¨‹

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Hugo 0.146.0 Release Notes](https://github.com/gohugoio/hugo/releases/tag/v0.146.0)
- [PaperMod ä¸»é¢˜æ–‡æ¡£](https://github.com/adityatelange/hugo-PaperMod/wiki)
- [Hugo æ¨¡æ¿å‡½æ•°](https://gohugo.io/functions/)
- [Vercel æ„å»ºé…ç½®](https://vercel.com/docs/concepts/projects/configuration)

---

## ğŸ“Œ å¾…åŠäº‹é¡¹

- [ ] é…ç½® Google Analytics IDï¼ˆå¦‚æœéœ€è¦ï¼‰
- [ ] éƒ¨ç½² Twikoo è¯„è®ºæœåŠ¡
- [ ] æ›´æ–° Twikoo `envId` é…ç½®
- [ ] æµ‹è¯•è¯„è®ºåŠŸèƒ½

---

**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æœ€åæ›´æ–°**: 2026-01-06 16:34:20
